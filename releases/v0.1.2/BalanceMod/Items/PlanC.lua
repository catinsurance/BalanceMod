local a=require("BalanceMod.Utility.PlayerTracker")local b=require("BalanceMod.Utility.SaveManager")local c={Item=Isaac.GetItemIdByName("Plan C"),FloodedFlag=1<<8}function c:NewRoom()local d=b:Get("PlanC")if d==nil then return end;for e,f in ipairs(a:GetPlayers())do local g=a:GetPlayerIndex(f)if d[g]~=nil then f:Kill()d[g]=nil;b:Set("PlanC",c.PlayersToKill)end end end;function c:OnUse(e,e,f)local h=false;for e,i in ipairs(Isaac.GetRoomEntities())do if i:IsEnemy()then h=true;i:BloodExplode()i:TakeDamage(9999999,DamageFlag.DAMAGE_IGNORE_ARMOR,EntityRef(i),0)end end;if h then Game():GetRoom():EmitBloodFromWalls(30,10)if c.PlayersToKill==nil then c.PlayersToKill={}end;c.PlayersToKill[a:GetPlayerIndex(f)]=true;b:Set("PlanC",c.PlayersToKill)return{Remove=true,ShowAnim=true}end end;function c:OnRunEnd()c.PlayersToKill=nil end;return function(j)j:AddCallback(ModCallbacks.MC_USE_ITEM,c.OnUse,c.Item)j:AddCallback(ModCallbacks.MC_POST_NEW_ROOM,c.NewRoom)if EID then EID:addCollectible(c.Item,"Kills all enemies in the room#Kills the player upon entering the next room#Consumed on use")end;return{OldItemId=CollectibleType.COLLECTIBLE_PLAN_C,NewItemId=c.Item}end