local a=require("BalanceMod.API.GiantBookApi")local b=require("BalanceMod.Utility.PoolHelper")local c={Item=Isaac.GetItemIdByName("D10"),RerolledEntities=false,EnemiesToRemove={},ChampionsToLoot={[ChampionColor.RED]=function(d,e)local f=d.Entity;Isaac.Spawn(EntityType.ENTITY_PICKUP,PickupVariant.PICKUP_HEART,b.PickupNullIndex,f.Position,Vector(0,0),f)end,[ChampionColor.YELLOW]=function(d,e)local f=d.Entity;Isaac.Spawn(EntityType.ENTITY_PICKUP,PickupVariant.PICKUP_LIL_BATTERY,b.PickupNullIndex,f.Position,Vector(0,0),f)end,[ChampionColor.GREEN]=function(d,e)local f=d.Entity;Isaac.Spawn(EntityType.ENTITY_PICKUP,PickupVariant.PICKUP_PILL,PillColor.PILL_NULL,f.Position,Vector(0,0),f)end,[ChampionColor.ORANGE]=function(d,e)local f=d.Entity;for g=0,1 do Isaac.Spawn(EntityType.ENTITY_PICKUP,PickupVariant.PICKUP_COIN,b.PickupNullIndex,f.Position,Vector(0,0),f)end end,[ChampionColor.BLUE]=function(d,e,h)local f=d.Entity;local i=h.Entity:ToPlayer()i:AddBlueFlies(3,i.Position,i)end,[ChampionColor.BLACK]=function(d,e)local f=d.Entity;Isaac.Explode(f.Position,f,100)Isaac.Spawn(EntityType.ENTITY_PICKUP,PickupVariant.PICKUP_BOMB,b.PickupNullIndex,f.Position,Vector(0,0),f)end,[ChampionColor.WHITE]=function(d,e)local f=d.Entity;Isaac.Spawn(EntityType.ENTITY_PICKUP,PickupVariant.PICKUP_HEART,HeartSubType.HEART_ETERNAL,f.Position,Vector(0,0),f)end,[ChampionColor.GREY]=function(d,e)local f=d.Entity;Isaac.Spawn(EntityType.ENTITY_PICKUP,PickupVariant.PICKUP_KEY,b.PickupNullIndex,f.Position,Vector(0,0),f)end,[ChampionColor.TRANSPARENT]=function(d,e)local f=d.Entity;local j=0.01;if j>e:RandomFloat()then Isaac.Spawn(EntityType.ENTITY_PICKUP,PickupVariant.PICKUP_MEGACHEST,ChestSubType.CHEST_CLOSED,f.Position,Vector(0,0),f)else Isaac.Spawn(EntityType.ENTITY_PICKUP,PickupVariant.PICKUP_LOCKEDCHEST,ChestSubType.CHEST_CLOSED,f.Position,Vector(0,0),f)end end,[ChampionColor.FLICKER]=function(d,e)local f=d.Entity;Isaac.Spawn(EntityType.ENTITY_PICKUP,PickupVariant.PICKUP_REDCHEST,ChestSubType.CHEST_CLOSED,f.Position,Vector(0,0),f)end,[ChampionColor.PINK]=function(d,e)local f=d.Entity;Isaac.Spawn(EntityType.ENTITY_PICKUP,PickupVariant.PICKUP_TAROTCARD,Game():GetItemPool():GetCard(e:GetSeed(),true,false,false),f.Position,Vector(0,0),f)end,[ChampionColor.PURPLE]=function(d,e)local f=d.Entity;Isaac.Spawn(EntityType.ENTITY_PICKUP,PickupVariant.PICKUP_TRINKET,b.PickupNullIndex,f.Position,Vector(0,0),f)end,[ChampionColor.DARK_RED]=function(d,e)local f=d.Entity;Isaac.Spawn(EntityType.ENTITY_PICKUP,PickupVariant.PICKUP_HEART,HeartSubType.HEART_DOUBLEPACK,f.Position,Vector(0,0),f)end,[ChampionColor.LIGHT_BLUE]=function(d,e)local f=d.Entity;Isaac.Spawn(EntityType.ENTITY_PICKUP,PickupVariant.PICKUP_HEART,HeartSubType.HEART_HALF,f.Position,Vector(0,0),f)end,[ChampionColor.CAMO]=function(d,e)local f=d.Entity;Isaac.Spawn(EntityType.ENTITY_PICKUP,PickupVariant.PICKUP_TAROTCARD,Game():GetItemPool():GetCard(e:GetSeed(),false,true,true),f.Position,Vector(0,0),f)end,[ChampionColor.PULSE_GREEN]=function(d,e)local f=d.Entity;Isaac.Spawn(EntityType.ENTITY_PICKUP,PickupVariant.PICKUP_GRAB_BAG,b.PickupNullIndex,f.Position,Vector(0,0),f)end,[ChampionColor.PULSE_GREY]=function(d,e)local f=d.Entity;Isaac.Spawn(EntityType.ENTITY_PICKUP,PickupVariant.PICKUP_HEART,HeartSubType.HEART_BLENDED,f.Position,Vector(0,0),f)end,[ChampionColor.FLY_PROTECTED]=function(d,e,h)local f=d.Entity;local i=h.Entity:ToPlayer()for k=0,2 do i:AddBlueSpider(i.Position)end end,[ChampionColor.TINY]=function(d,e)local f=d.Entity;local l=Game():GetItemPool()Isaac.Spawn(EntityType.ENTITY_PICKUP,PickupVariant.PICKUP_PILL,l:ForceAddPillEffect(PillEffect.PILLEFFECT_SMALLER),f.Position,Vector(0,0),f)end,[ChampionColor.GIANT]=function(d,e)local f=d.Entity;local l=Game():GetItemPool()Isaac.Spawn(EntityType.ENTITY_PICKUP,PickupVariant.PICKUP_PILL,l:ForceAddPillEffect(PillEffect.PILLEFFECT_LARGER),f.Position,Vector(0,0),f)end,[ChampionColor.PULSE_RED]=function(d,e)local f=d.Entity;Game():SpawnParticles(f.Position,EffectVariant.PLAYER_CREEP_RED,10,0,Color(1,0,0,1,0,0,0),0)end,[ChampionColor.SIZE_PULSE]=function(d,e,h)local f=d.Entity;local i=h.Entity:ToPlayer()for k=0,1 do Isaac.Spawn(EntityType.ENTITY_FAMILIAR,FamiliarVariant.BLUE_FLY,LocustSubtypes.LOCUST_OF_WRATH,i.Position,Vector(0,0),i)end end,[ChampionColor.KING]=function(d,e)local f=d.Entity;Isaac.Spawn(EntityType.ENTITY_PICKUP,PickupVariant.PICKUP_COIN,CoinSubType.COIN_DIME,f.Position,Vector(0,0),f)end,[ChampionColor.DEATH]=function(d,e)local f=d.Entity;Isaac.Spawn(EntityType.ENTITY_PICKUP,PickupVariant.PICKUP_HEART,HeartSubType.HEART_BLACK,f.Position,Vector(0,0),f)end,[ChampionColor.BROWN]=function(d,e)local f=d.Entity;Game():Fart(f.Position)end,[ChampionColor.RAINBOW]=function(d,e)local f=d.Entity;local m=Game()Isaac.Spawn(EntityType.ENTITY_PICKUP,PickupVariant.PICKUP_COLLECTIBLE,m:GetItemPool():GetCollectible(ItemPoolType.POOL_SHOP,true,e:GetSeed()),f.Position,Vector(0,0),f)end}}function c:OnUse(g,e,i)local n=Isaac.GetRoomEntities()for g,o in ipairs(n)do local f=o:ToNPC()if f then if f:CanReroll()and f:IsEnemy()and f:IsChampion()then local p=f:GetChampionColorIdx()c.ChampionsToLoot[p](EntityRef(f),e,EntityRef(i))Game():RerollEnemy(o)c.RerolledEntities=true end end end;return true end;function c:OnRoomLeft()c.RerolledEntities=false;c.EnemiesToRemove={}end;function c:GameUpdate()if c.RerolledEntities then local n=Isaac.GetRoomEntities()for g,o in ipairs(n)do local f=o:ToNPC()if f then if f:IsEnemy()and f:IsChampion()then f:Remove()local q=Isaac.Spawn(f.Type,f.Variant,f.SubType,f.Position,Vector(0,0),f)if f:HasEntityFlags(EntityFlag.FLAG_CONFUSION)then q:AddConfusion(EntityRef(f),60,true)end end end end;c.RerolledEntities=false end end;return function(r)r:AddCallback(ModCallbacks.MC_USE_ITEM,c.OnUse,c.Item)r:AddCallback(ModCallbacks.MC_POST_NEW_ROOM,c.OnRoomLeft)r:AddCallback(ModCallbacks.MC_POST_GAME_STARTED,c.OnRoomLeft)r:AddCallback(ModCallbacks.MC_POST_UPDATE,c.GameUpdate)r:AddCallback(ModCallbacks.MC_POST_GAME_END,c.OnRoomLeft)if EID then EID:addCollectible(c.Item,"Rerolls champions on use#Rerolled champions will become non-champions#Rerolled champions will drop special loot based on their color")end;return{OldItemId=CollectibleType.COLLECTIBLE_D10,NewItemId=c.Item}end