local a=Vector(0,0)local b=Game()local c={}local d={}local e=Vector(-19,-54)local f=Vector(-20,0)local g=101;local h=9;local i=6;local j=12;local k={Normal=0,Deleting=1,ChargedStart=2,ChargedAnimDone=3}c.DefaultSprite="gfx/chargebar.anm2"c.ChargeBarOffset=e;c.ChargeBarOverlapOffset=f;c.ChargeBarFrameCount=g;c.ChargeBarDeleteFrameCount=h;c.ChargeBarChargedFrameCount=i;c.ChargeBarStartChargedFrameCount=j;c.ChargeBarState=k;local function l(table)local m=0;for n in pairs(table)do m=m+1 end;return m end;local function o(p)local q=1;local r=p:GetPlayerType()if r==PlayerType.PLAYER_LAZARUS2_B then q=2 end;local s=p:GetCollectibleRNG(q):GetSeed()return tostring(s)end;local function t()local u=b:GetNumPlayers()local v={}for w=0,u do local p=Isaac.GetPlayer(w)table.insert(v,p)end;return v end;local function x(y,z,A)if y<z then return z elseif y>A then return A end;return y end;local function B(C)local D=2^52;if math.abs(C)>D then return C end;return C<0 and C-D+D or C+D-D end;function c:MakeCustomChargeBar(p,E,F,G,H)local I=o(p)if d[I]==nil then d[I]={}end;local J=l(d[I])+1;d[I][J]={Index=J,State=k.Normal,Sprite=E,Charge=F,MaxCharge=G,IncrementValue=H}return J end;function c:UpdateCustomBarState(p,K,L)local I=o(p)local M=d[I]if not M then return end;if M[K]==nil then return end;M[K].State=x(L,k.Normal,k.ChargedAnimDone)if L==k.Deleting then M[K].Sprite:Play("Disappear",true)elseif L==k.ChargedStart then M[K].Sprite:Play("StartCharged",true)elseif L==k.ChargedAnimDone then M[K].Sprite:Play("Charged",true)elseif L==k.Normal then M[K].Sprite:Play("Charging",true)end end;function c:GetCustomChargeBarCharge(p,K)local I=o(p)local M=d[I]if not M then return nil end;local N=M[K]if N==nil then return nil end;return N.Charge,N.MaxCharge,N.IncrementValue end;function c:UpdateCustomChargeBar(p,K)local I=o(p)if d[I]==nil then d[I]={}end;if d[I][K]==nil then return end;if d[I][K].State==k.Normal then d[I][K].Charge=x(d[I][K].Charge+d[I][K].IncrementValue,1,d[I][K].MaxCharge)end;local N=d[I][K]if N.State==k.Deleting then if N.Sprite:IsFinished("Disappear")then d[I][K]=nil;N=nil;return end end;local O=p:GetFlyingOffset()local P=p.SpriteScale*e;local Q=f*(N.Index-1)local R=p.Position+Q+O+P;if N.State==k.Normal then local S=g/N.MaxCharge;local T=x(B(N.Charge*S),1,g)N.Sprite:SetFrame("Charging",T)else if b:GetFrameCount()%2==0 then N.Sprite:Update()end end;local U=b:GetRoom():WorldToScreenPosition(R)N.Sprite:Render(U,a,a)end;function c:UpdateAllCustomChargeBars()for n,p in ipairs(t())do local I=o(p)local M=d[I]if M==nil then d[I]={}M={}end;for n,N in pairs(M)do c:UpdateCustomChargeBar(p,N.Index)end end end;function c:UpdateChargeBarsForPlayer(p)local I=o(p)local M=d[I]if M==nil then d[I]={}M={}end;for n,N in pairs(M)do c:UpdateCustomChargeBar(p,N.Index)end end;function c:DeleteCustomChargeBar(p,J)c:UpdateCustomBarState(p,J,k.Deleting)end;return c